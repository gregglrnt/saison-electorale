datasource db {
  provider = "postgres"
  url      = "postgresql://postgres:brWKd35UU39WV5@database:5432?connect_timeout=300"
}

generator client {
  provider             = "prisma-client-py"
  recursive_type_depth = 5
}

model Station {
  id          String    @id
  coordinates String    @unique
  zip         String    
  commune     String
  Meteo       Meteo[]
  Commune     Commune[]
}

model Meteo {
  stationId           String
  date                DateTime
  wind_speed          Float?
  temperature_kelvin  Float?
  temperature_celsius Float?
  humidity            Float?
  cloudiness          Float? //nébulosité
  ice_height          Float?
  rain                Float?
  station             Station  @relation(fields: [stationId], references: [id])

  @@id([stationId, date])
}

model Commune {
  zip            String?
  code           String    @id @unique
  insee_code     String?   @unique
  departement    String?
  label          String
  centroid       String?
  Results        Results[]
  closer_station Station?  @relation(fields: [stationId], references: [id])
  stationId      String?
}

enum ElectionType {
  LEG
  PRES
  EURO
  DEP
  MUNI
  REG
}

model Election {
  id      Int          @unique @default(autoincrement())
  date    DateTime
  type    ElectionType
  round   Int          @default(1)
  Results Results[]
}

model Results {
  communeId    String
  commune      Commune  @relation(fields: [communeId], references: [code])
  ballot       Election @relation(fields: [ballotId], references: [id])
  ballotId     Int
  abstention   Float
  voters       Float
  invalidVotes Float

  @@id([ballotId, communeId])
}
